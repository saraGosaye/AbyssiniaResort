<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User List</title>
    <link rel="stylesheet" th:href="@{https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css}">
    <!-- custom CSS -->
    <link rel="stylesheet" th:href="@{/css/styleHome.css}">
</head>
<body>

<!-- Header -->
<div th:replace="~{fragment/nav_footer :: navbar}"></div>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>User List</h3>
        <a class="btn btn-success" href="/users/new">Create New User</a>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-bordered">
            <thead class="thead-dark">
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.id}"></td>
                <td th:text="${user.firstName}"></td>
                <td th:text="${user.lastName}"></td>
                <td th:text="${user.email}"></td>
                <td>
                    <ul class="list-inline">
                        <li class="list-inline-item badge badge-info" th:each="role : ${user.roles}" th:text="${role.roleName}"></li>
                    </ul>
                </td>
                <td>
                    <a class="btn btn-info btn-sm" th:href="@{/users/details/{id}(id=${user.id})}">Details</a>
                    <a class="btn btn-warning btn-sm" th:href="@{/users/update/{id}(id=${user.id})}">Edit</a>
                    <button class="btn btn-danger btn-sm delete-user-btn" th:data-email="${user.email}">Delete</button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Footer -->
<div th:replace="~{fragment/nav_footer :: footer}"></div>

<!-- Scripts for Bootstrap and jQuery -->
<script th:src="@{https://code.jquery.com/jquery-3.5.1.min.js}"></script>
<script th:src="@{https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js}"></script>

<script>
    $(document).ready(function() {
        // Delete user confirmation
        $('.delete-user-btn').on('click', function() {
            const email = $(this).data('email');
            const confirmed = confirm('Are you sure you want to delete this user?');
            if (confirmed) {
                $.ajax({
                    url: '/users/delete/' + email,
                    type: 'POST',
                    success: function(result) {
                        location.reload();
                    },
                    error: function(err) {
                        alert('Error deleting user. Please try again.');
                    }
                });
            }
        });
    });
</script>

</body>
</html>
